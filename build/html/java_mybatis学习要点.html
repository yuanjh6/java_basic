

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>java_mybatis学习要点 &mdash; java基础 v1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="java_微服务01学习笔记" href="java_微服务01学习笔记.html" />
    <link rel="prev" title="java_spring05循环依赖" href="java_spring05循环依赖.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> java基础
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="java_读书01guide学习笔记.html">java_读书01guide学习笔记</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_读书02java核心面试知识整理.html">java_读书02java核心面试知识整理</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_读书03Java基础高频面试题(2021年最新版).html">java_读书03Java基础高频面试题(2021年最新版)</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_读书05殷建卫架构笔记之java.html">java_读书05殷建卫架构笔记之java</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_基础01常见坑.html">java_基础01常见坑</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_基础02集合.html">java_基础02集合</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_基础03双亲委派.html">java_基础03双亲委派</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_基础04内存结构和gc垃圾回收.html">java_基础04内存结构和gc垃圾回收</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程01JMM内存模型.html">java_并发编程01JMM内存模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程02Volatile.html">java_并发编程02Volatile</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程03Atomic原子类和CAS.html">java_并发编程03Atomic原子类和CAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程04Synchronized.html">java_并发编程04Synchronized</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程05从锁到ReentrantLock.html">java_并发编程05从锁到ReentrantLock</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程06从ReentrantLock到AQS.html">java_并发编程06从ReentrantLock到AQS</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程07锁相关小结.html">java_并发编程07锁相关小结</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程08CyclicBarrier_CountDownLatch_Semaphore.html">java_并发编程08CyclicBarrier_CountDownLatch_Semaphore</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程09ThreadLocal.html">java_并发编程09ThreadLocal</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程10阻塞队列.html">java_并发编程10阻塞队列</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_并发编程11线程池.html">java_并发编程11线程池</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_spring01读书要点.html">java_spring01读书要点</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_spring02ioc有什么优点.html">java_spring02ioc有什么优点</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_spring03依赖注入与自动装配区别.html">java_spring03依赖注入与自动装配区别</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_spring04Autowired与Resource差异解析.html">java_spring04Autowired与Resource差异解析</a></li>
<li class="toctree-l1"><a class="reference internal" href="java_spring05循环依赖.html">java_spring05循环依赖</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">java_mybatis学习要点</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">工作原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">核心组件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sqlsessionfactory">SqlSessionFactory及其常见创建方式</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sqlsession">SqlSession简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">实现映射器</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sql-sqlsessionmapper">执行SQL的两种方式：SqlSession和Mapper接口(略)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">核心组件的作用域以及生命周期</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">配置文件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#properties">properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#settings">settings属性配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="#typealiases">typeAliases（别名）（不常用）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#typehandler">TypeHandler类型转换器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">系统定义的TypeHandler（略）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">自定义TypeHandler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">自定义TypeHandler处理枚举</a></li>
<li class="toctree-l3"><a class="reference internal" href="#blobtypehandlerblob">BlobTypeHandler读取Blob类型字段（略）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environmentstransactionmanagerdatasource">配置文件environments和子元素transactionManager、dataSource（略）</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#spring">Spring整合</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mapjava-bean">使用Map接口和Java Bean传递多个参数</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">常用操作标签</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#insert">insert</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updatedelete">update、delete</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sql">sql元素</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#resultmap">resultMap元素的结构及使用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#map">使用 Map 存储结果集</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pojo">pojo使存储结果</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">关联查询（级联查询）</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id11">动态sql</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">动态sql</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choosewhenotherwise">choose、when、otherwise标签</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trim">trim</a></li>
<li class="toctree-l3"><a class="reference internal" href="#where">where</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#foreach">foreach</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bind">bind标签</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id13">参考</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="java_微服务01学习笔记.html">java_微服务01学习笔记</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">java基础</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>java_mybatis学习要点</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/java_mybatis学习要点.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="java-mybatis">
<h1>java_mybatis学习要点<a class="headerlink" href="#java-mybatis" title="Permalink to this headline">¶</a></h1>
<p>MyBatis 是一个小巧、方便、高效、简单、直接、半自动化的持久层框架，Hibernate 是一个强大、方便、高效、复杂、间接、全自动化的持久层框架。</p>
<div class="section" id="id1">
<h2>工作原理<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p><img alt="_images/20210317195133240_114936123.png" src="_images/20210317195133240_114936123.png" /></p>
</div>
<div class="section" id="id2">
<h2>核心组件<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>SqlSessionFactoryBuilder、SqlSessionFactory、SqlSession和SQL Mapper</p>
<p>1）SqlSessionFactoryBuilder（构造器）：它会根据配置或者代码来<strong>生成 SqlSessionFactory</strong>，采用的是分步构建的 Builder 模式。</p>
<p>2）SqlSessionFactory（工厂接口）：依靠它来<strong>生成 SqlSession</strong>，使用的是工厂模式。</p>
<p>3）SqlSession（会话）：一个既可以<strong>发送 SQL 执行</strong>返回结果，也可以<strong>获取 Mapper 的接口</strong>。在现有的技术中，一般我们会让其在业务逻辑代码中“消失”，而使用的是MyBatis提供的 SQL Mapper接口编程技术，它能提高代码的可读性和可维护性。</p>
<p>4）SQL Mapper（映射器）:MyBatis 新设计存在的组件，它由一个 Java 接口和 XML 文件（或注解）构成，需要给出对应的 SQL 和映射规则。它负责<strong>发送 SQL 去执行</strong>，并返回结果。</p>
<p><img alt="_images/20210317195356817_2063667104.png" src="_images/20210317195356817_2063667104.png" /></p>
</div>
<div class="section" id="sqlsessionfactory">
<h2>SqlSessionFactory及其常见创建方式<a class="headerlink" href="#sqlsessionfactory" title="Permalink to this headline">¶</a></h2>
<p>SqlSessionFactory 是一个接口，在 MyBatis 中它存在<strong>两个实现类：SqlSessionManager 和 DefaultSqlSessionFactory</strong>。</p>
<p>一般而言，具体是由 DefaultSqlSessionFactory 去实现的，而 SqlSessionManager 使用在多线程的环境中，它的具体实现依靠 DefaultSqlSessionFactory，</p>
<p>http://c.biancheng.net/uploads/allimg/190704/5-1ZF416213S21.png</p>
<p>两者的区别主要就是</p>
<p><strong>SqlSessionManager 实现了Session接口</strong>。意味着，SqlSessionManager集成了 sqlSessionFactory和session 的功能。通过SqlSessionManager，开发者可以不在理会SqlSessionFacotry的存在，直接面向Session编程。</p>
<p>SqlSessionManager 内部提供了一个sqlSessionProxy,这个sqlSessionProxy提供了所有Session接口的实现，而实现中正是使用了上面提到的本地线程保存的session实例。</p>
<p>这样，在同一个线程实现不同的sql操作，可以复用本地线程session，避免了DefaultSqlSessionFactory实现的每一个sql操作都要创建新的session实例。</p>
<p><strong>用 XML 构建 SqlSessionFactory</strong></p>
<p>mybatis-config.xml，放在工程类路径下，其内容如下所示。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;

&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;

&lt;configuration&gt;

    &lt;typeAliases&gt;&lt;!--别名--&gt;

        &lt;typeAliases alias=&quot;user&quot; type=&quot;com.mybatis.po.User&quot;/&gt;

    &lt;/typeAliases&gt;

    &lt;!-- 数据库环境 --&gt;

    &lt;environments default=&quot;development&quot;&gt;

        &lt;environment id=&quot;development&quot;&gt;

            &lt;!-- 使用JDBC的事务管理 --&gt;

            &lt;transactionManager type=&quot;JDBC&quot; /&gt;

            &lt;dataSource type=&quot;POOLED&quot;&gt;

                &lt;!-- MySQL数据库驱动 --&gt;

                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;

                &lt;!-- 连接数据库的URL --&gt;

                &lt;property name=&quot;url&quot;

                    value=&quot;jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf8&quot; /&gt;

                &lt;property name=&quot;username&quot; value=&quot;root&quot; /&gt;

                &lt;property name=&quot;password&quot; value=&quot;1128&quot; /&gt;

            &lt;/dataSource&gt;

        &lt;/environment&gt;

    &lt;/environments&gt;

    &lt;!-- 将mapper文件加入到配置文件中 --&gt;

    &lt;mappers&gt;

        &lt;mapper resource=&quot;com/mybatis/mapper/UserMapper.xml&quot; /&gt;

    &lt;/mappers&gt;

&lt;/configuration&gt;
</pre></div>
</div>
<p>说明</p>
<p><typeAlias> 元素定义了一个别名 user，它代表着 com.mybatis.po.User 这个类。这样定义后，在 MyBatis 上下文中就可以使用别名去代替全限定名了。</p>
<p><environment> 元素的定义，这里描述的是数据库。它里面的 <transactionManager> 元素是配置事务管理器，这里采用的是 MyBatis 的 JDBC 管理器方式。</p>
<p><dataSource> 元素配置数据库，其中属性 type=”POOLED” 代表采用 <strong>MyBatis 内部提供的连接池</strong>方式，最后定义一些关于 JDBC 的属性信息。</p>
<p><mapper> 元素代表引入的那些映射器，在谈到映射器时会详细讨论它。</p>
<p>有了基础配置文件，就可以用一段很简短的代码来生成 SqlSessionFactory 了，如下所示。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">SqlSessionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>

<span class="n">String</span> <span class="n">resource</span> <span class="o">=</span> <span class="s2">&quot;mybatis-config.xml&quot;</span><span class="p">;</span>

<span class="n">InputStream</span> <span class="ow">is</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="n">InputStream</span> <span class="ow">is</span> <span class="o">=</span> <span class="n">Resources</span><span class="o">.</span><span class="n">getResourceAsStream</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>

    <span class="n">factory</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SqlSessionFactoryBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ow">is</span><span class="p">);</span>

<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>代码创建 SqlSessionFactory（略）</strong></p>
</div>
<div class="section" id="sqlsession">
<h2>SqlSession简介<a class="headerlink" href="#sqlsession" title="Permalink to this headline">¶</a></h2>
<p>在 MyBatis 中，SqlSession 是其核心接口。在 MyBatis 中有<strong>两个实现类，DefaultSqlSession 和 SqlSessionManager</strong>。</p>
<p><strong>DefaultSqlSession 是单线程使用的，而 SqlSessionManager 在多线程环境下使用</strong>。SqlSession 的作用类似于一个 JDBC 中的 Connection 对象，代表着一个连接资源的启用。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">//</span><span class="n">定义</span> <span class="n">SqlSession</span>

<span class="n">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="o">//</span> <span class="n">打开</span> <span class="n">SqlSession</span> <span class="n">会话</span>

    <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">SqlSessionFactory</span><span class="o">.</span><span class="n">openSession</span><span class="p">();</span>

    <span class="o">//</span> <span class="n">some</span> <span class="n">code</span><span class="o">...</span>

    <span class="n">sqlSession</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>    <span class="o">//</span> <span class="n">提交事务</span>

<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">sqlSession</span><span class="o">.</span><span class="n">rollback</span><span class="p">();</span>  <span class="o">//</span> <span class="n">回滚事务</span>

<span class="p">}</span><span class="k">finally</span><span class="p">{</span>

    <span class="o">//</span> <span class="n">在</span> <span class="k">finally</span> <span class="n">语句中确保资源被顺利关闭</span>

    <span class="k">if</span><span class="p">(</span><span class="n">sqlSession</span> <span class="o">!=</span> <span class="n">null</span><span class="p">){</span>

        <span class="n">sqlSession</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>实现映射器<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>2种方式：XML文件形式(常用)和注解形式(基本不使用)</p>
<p>xml举例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">&lt;</span><span class="n">mapper</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;com.mybatis.mapper.RoleMapper&quot;</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">select</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;getRole&quot;</span> <span class="n">parameterType</span><span class="o">=</span><span class="s2">&quot;long&quot;</span> <span class="n">resultType</span><span class="o">=</span><span class="s2">&quot;role&quot;</span><span class="o">&gt;</span>

        <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span><span class="n">role_name</span> <span class="k">as</span> <span class="n">roleName</span><span class="p">,</span><span class="n">note</span> <span class="n">FROM</span> <span class="n">role</span> <span class="n">WHERE</span> <span class="nb">id</span> <span class="o">=</span><span class="c1">#{id}</span>

    <span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">mapper</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="sql-sqlsessionmapper">
<h2>执行SQL的两种方式：SqlSession和Mapper接口(略)<a class="headerlink" href="#sql-sqlsessionmapper" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id4">
<h2>核心组件的作用域以及生命周期<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p><strong>SqlSessionFactoryBuilder</strong></p>
<p>SqlSessionFactoryBuilder 的作用在于创建 SqlSessionFactory，因此 SqlSessionFactoryBuilder 实例的最佳作用域是方法作用域（也就是局部方法变量）。</p>
<p><strong>SqlSessionFactory</strong></p>
<p>SqlSessionFactory 可以被认为是一个数据库连接池，所以 SqlSessionFactory 的生命周期存在于整个 MyBatis 的应用之中，</p>
<p>如果创建多个 SqlSessionFactory，那么就存在多个数据库连接池，这样不利于对数据库资源的控制，</p>
<p>因此我们往往希望 SqlSessionFactory 作为一个单例，让它在应用中被共享。所以说 SqlSessionFactory 的最佳作用域是应用作用域。</p>
<p><strong>SqlSession</strong></p>
<p>SqlSession 就相当于一个数据库连接（Connection 对象），应该存活在一个业务请求中，处理完整个请求后，应该关闭这条连接</p>
<p>SqlSession 的最佳的作用域是请求或方法作用域。</p>
<p><strong>Mapper</strong></p>
<p>Mapper 是一个接口，它由 SqlSession 所创建，所以它的最大生命周期至多和 SqlSession 保持一致，</p>
<p>http://c.biancheng.net/uploads/allimg/190705/5-1ZF5104453328.png</p>
</div>
<div class="section" id="id5">
<h2>配置文件<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>需要注意的是，MyBatis 配置项的<strong>顺序不能颠倒</strong>。如果颠倒了它们的顺序，那么在 MyBatis 启动阶段就会发生异常，导致程序无法运行。</p>
<div class="section" id="properties">
<h3>properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<p>MyBatis 提供了 3 种方式让我们使用 properties，它们是：</p>
<p>property 子元素。</p>
<p>properties 文件。</p>
<p>程序代码传递。</p>
<p>这个不再细说了，比较常用的是properties文件</p>
</div>
<div class="section" id="settings">
<h3>settings属性配置<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h3>
<p>较多，常用如下</p>
<p>cacheEnabled：该配置影响所有映射器中配置缓存的全局开关
lazyLoadingEnabled：延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。在特定关联关系中可通过设置 fetchType 属性来覆盖该项的开关状态
aggressiveLazyLoading：当启用时，对任意延迟属性的调用会使带有延迟加载属性的对象完整加载；反之，每种属性将会按需加载
autoMappingBehavior：指定 MyBatis 应如何自动映射列到字段或属性。</p>
<p>NONE 表示取消自动映射。</p>
<p>PARTIAL 表示只会自动映射，没有定义嵌套结果集和映射结果集。</p>
<p>FULL 会自动映射任意复杂的结果集（无论是否嵌套）
mapUnderscoreToCamelCase：是否开启自动驼峰命名规则映射，即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。</p>
<p>defaultExecutorType：配置默认的执行器。SIMPLE 是普通的执行器；REUSE 会重用预处理语句（prepared statements）；BATCH 执行器将重用语句并执行批量更新</p>
</div>
<div class="section" id="typealiases">
<h3>typeAliases（别名）（不常用）<a class="headerlink" href="#typealiases" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="typehandler">
<h3>TypeHandler类型转换器<a class="headerlink" href="#typehandler" title="Permalink to this headline">¶</a></h3>
<p>在 typeHandler 中，分为 jdbcType 和 javaType，其中 jdbcType 用于定义数据库类型，而 javaType 用于定义 Java 类型，那么 typeHandler 的作用就是承担 jdbcType 和 javaType 之间的相互转换。</p>
<p><img alt="5-1ZFZ92210195" src="_images/20210317220554091_950418641.png" /></p>
</div>
<div class="section" id="id6">
<h3>系统定义的TypeHandler（略）<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id7">
<h3>自定义TypeHandler<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>从系统定义的 typeHandler 可以知道，要实现 typeHandler 就需要去实现接口 typeHandler，或者继承 BaseTypeHandler（实际上，BaseTypeHandler 实现了 typeHandler 接口）。</p>
<p>实例参考：场景一：有个java.util.Date在存入数据库的时候自动转换为timestamp时间戳，从数据库取值的时候把时间戳自动转换为java.util.Date样例：https://www.cnblogs.com/snake23/p/9606576.html</p>
</div>
<div class="section" id="id8">
<h3>自定义TypeHandler处理枚举<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>MyBatis自定义TypeHandler处理枚举：http://c.biancheng.net/view/4343.html</p>
</div>
<div class="section" id="blobtypehandlerblob">
<h3>BlobTypeHandler读取Blob类型字段（略）<a class="headerlink" href="#blobtypehandlerblob" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="environmentstransactionmanagerdatasource">
<h3>配置文件environments和子元素transactionManager、dataSource（略）<a class="headerlink" href="#environmentstransactionmanagerdatasource" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="spring">
<h2>Spring整合<a class="headerlink" href="#spring" title="Permalink to this headline">¶</a></h2>
<p><strong>在Spring中配置MyBatis工厂</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
&lt;!-- 配置SqlSessionFactoryBean --&gt;

&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;

    &lt;!-- 引用数据源组件 --&gt;

    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;

    &lt;!-- 引用MyBatis配置文件中的配置 --&gt;

    &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot; /&gt;

&lt;/bean&gt;
</pre></div>
</div>
<p><strong>使用 Spring 管理 MyBatis 的数据操作接口</strong></p>
<p>最常用、最简洁的一种是基于 MapperScannerConfigurer 的整合。该方式需要在 Spring 的配置文件中加入以下内容：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
&lt;!-- Mapper代理开发，使用Spring自动扫描MyBatis的接口并装配 （Sprinh将指定包中的所有被@Mapper注解标注的接口自动装配为MyBatis的映射接口） --&gt;

&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;

    &lt;!-- mybatis-spring组件的扫描器，com.dao只需要接口（接口方法与SQL映射文件中的相同） --&gt;

    &lt;property name=&quot;basePackage&quot; value=&quot;com.dao&quot; /&gt;

    &lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot; /&gt;

&lt;/bean&gt;
</pre></div>
</div>
<p><strong>MyBatis与Spring的整合实例详解</strong>:http://c.biancheng.net/view/4355.html</p>
</div>
<div class="section" id="mapjava-bean">
<h2>使用Map接口和Java Bean传递多个参数<a class="headerlink" href="#mapjava-bean" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>public List&lt;MyUser&gt; selectAllUser(Map&lt;String,Object&gt; param);  
&lt;!-- 查询陈姓男性用户信息 --&gt;  
&lt;select id=&quot;selectAllUser&quot; resultType=&quot;com.mybatis.po.MyUser&quot;&gt;  
    select * from user  
    where uname like concat(&#39;%&#39;,#{u_name},&#39;%&#39;)  
    and usex = #{u_sex}  
&lt;/select&gt;  
  
&lt;select id=&quot;selectAllUser&quot; resultType=&quot;com.po.MyUser&quot; parameterType=&quot;com.pojo.SeletUserParam&quot;&gt;  
    select * from user  
    where uname like concat(&#39;%&#39;,#{u_name},&#39;%&#39;)  
    and usex=#{u_sex}  
&lt;/select&gt;  
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2>常用操作标签<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="section" id="insert">
<h3>insert<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h3>
<p>1）主键（自动递增）回填</p>
<p>为 com.mybatis 包中的 SQL 映射文件 UserMapper.xml 中 id 为 addUser 的 <insert> 元素添加 keyProperty 和 useGeneratedKeys 属性，具体代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--添加一个用户，成功后将主键值返回填给uid(po的属性)--&gt;  
&lt;insert id=&quot;addUser&quot; parameterType=&quot;com.po.MyUser&quot; keyProperty=&quot;uid&quot; useGeneratedKeys=&quot;true&quot;&gt;  
    insert into user (uname,usex) values(#{uname},#{usex})  
&lt;/insert&gt;  
</pre></div>
</div>
<p>2）自定义主键</p>
<p>如果在实际工程中使用的数据库不支持主键自动递增（例如 Oracle），或者取消了主键自动递增的规则，可以使用 MyBatis 的 <selectKey> 元素来自定义生成主键。具体配置示例代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- 添加一个用户，#{uname}为 com.mybatis.po.MyUser 的属性值 --&gt;  
&lt;insert id=&quot;insertUser&quot; parameterType=&quot;com.po.MyUser&quot;&gt;  
    &lt;!-- 先使用selectKey元素定义主键，然后再定义SQL语句 --&gt;  
    &lt;selectKey keyProperty=&quot;uid&quot; resultType=&quot;Integer&quot; order=&quot;BEFORE&quot;&gt;  
    select if(max(uid) is null,1,max(uid)+1) as newUid from user)  
    &lt;/selectKey&gt;  
    insert into user (uid,uname,usex) values(#{uid},#{uname},#{usex})  
&lt;/insert&gt;  
</pre></div>
</div>
<p>在执行上述示例代码时，<selectKey> 元素首先被执行，该元素通过自定义的语句设置数据表的主键，然后执行插入语句。</p>
<p><selectKey> 元素的 keyProperty 属性指定了新生主键值返回给 PO 类（com.po.MyUser）的哪个属性。</p>
<p>order 属性可以设置为 BEFORE 或 AFTER。</p>
<p>BEFORE 表示先执行 <selectKey> 元素然后执行插入语句。</p>
<p>AFTER 表示先执行插入语句再执行 <selectKey> 元素。</p>
</div>
<div class="section" id="updatedelete">
<h3>update、delete<a class="headerlink" href="#updatedelete" title="Permalink to this headline">¶</a></h3>
<p><update> 和 <delete> 元素比较简单，它们的属性和 <insert> 元素、<select> 元素的属性差不多，执行后也返回一个整数，表示影响了数据库的记录行数。</p>
</div>
<div class="section" id="sql">
<h3>sql元素<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h3>
<p><sql> 元素的作用在于可以定义 SQL 语句的一部分（代码片段），以方便后面的 SQL 语句引用它，例如反复使用的列名。</p>
<p>在 MyBatis 中只需使用 <sql> 元素编写一次便能在其他元素中引用它。配置示例代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">sql</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;comColumns&quot;</span><span class="o">&gt;</span><span class="nb">id</span><span class="p">,</span><span class="n">uname</span><span class="p">,</span><span class="n">usex</span><span class="o">&lt;/</span><span class="n">sql</span><span class="o">&gt;</span>  
<span class="o">&lt;</span><span class="n">select</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;selectUser&quot;</span> <span class="n">resultType</span><span class="o">=</span><span class="s2">&quot;com.po.MyUser&quot;</span><span class="o">&gt;</span>  
    <span class="n">select</span> <span class="o">&lt;</span><span class="n">include</span> <span class="n">refid</span><span class="o">=</span><span class="s2">&quot;comColumns&quot;</span><span class="o">&gt;</span> <span class="kn">from</span> <span class="nn">user</span>  
<span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>  
</pre></div>
</div>
<p>在上述代码中使用 <include> 元素的 refid 属性引用了自定义的代码片段。</p>
</div>
</div>
<div class="section" id="resultmap">
<h2>resultMap元素的结构及使用<a class="headerlink" href="#resultmap" title="Permalink to this headline">¶</a></h2>
<div class="section" id="map">
<h3>使用 Map 存储结果集<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h3>
<p>任何 select 语句都可以使用 Map 存储结果，示例代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- 查询所有用户信息存到Map中 --&gt;  
&lt;select id=&quot;selectAllUserMap&quot; resultType=&quot;map&quot;&gt;  
    select * from user  
&lt;/select&gt;  
</pre></div>
</div>
</div>
<div class="section" id="pojo">
<h3>pojo使存储结果<a class="headerlink" href="#pojo" title="Permalink to this headline">¶</a></h3>
<p>配置 <resultMap> 元素</p>
<p>在 SQL 映射文件 UserMapper.xml 中配置 <resultMap> 元素，其属性 type 引用 POJO 类。具体配置如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--使用自定义结果集类型--&gt;  
&lt;resultMap type=&quot;com.pojo.MapUser&quot; id=&quot;myResult&quot;&gt;  
    &lt;!-- property 是 com.pojo.MapUser 类中的属性--&gt;  
    &lt;!-- column是查询结果的列名，可以来自不同的表--&gt;  
    &lt;id property=&quot;m_uid&quot; column=&quot;uid&quot;/&gt;  
    &lt;result property=&quot;m_uname&quot; column=&quot;uname&quot;/&gt;  
    &lt;result property=&quot;m_usex&quot; column=&quot;usex&quot;/&gt;  
&lt;/resultMap&gt;  
</pre></div>
</div>
<p>配置<select>元素</p>
<p>在 SQL 映射文件 UserMapper.xml 中配置 <select> 元素，其属性 resultMap 引用了 <resultMap> 元素的 id。具体配置如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- 使用自定义结果集类型查询所有用户 --&gt;  
&lt;select id=&quot;selectResultMap&quot; resultMap=&quot;myResult&quot;&gt;  
    select * from user  
&lt;/select&gt;  
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h2>关联查询（级联查询）<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p><strong>一对一</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- 一对一根据id查询个人信息：级联查询的第一种方法（嵌套查询，执行两个SQL语句）--&gt;  
&lt;resultMap type=&quot;com.po.Person&quot; id=&quot;cardAndPerson1&quot;&gt;  
	&lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;  
	&lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;  
	&lt;result property=&quot;age&quot; column=&quot;age&quot;/&gt;  
	&lt;!-- 一对一级联查询--&gt;  
	&lt;association property=&quot;card&quot; column=&quot;idcard_id&quot; javaType=&quot;com.po.Idcard&quot;  
	select=&quot;com.dao.IdCardDao.selectCodeByld&quot;/&gt;  
&lt;/resultMap&gt;  
</pre></div>
</div>
<p><strong>一对多</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- 一对多 根据uid查询用户及其关联的订单信息：级联查询的第一种方法（嵌套查询） --&gt;  
&lt;resultMap type=&quot;com.po.MyUser&quot; id=&quot;userAndOrders1&quot;&gt;  
    &lt;id property=&quot;uid&quot; column=&quot;uid&quot; /&gt;  
    &lt;result property=&quot;uname&quot; column=&quot;uname&quot; /&gt;  
    &lt;result property=&quot;usex&quot; column=&quot;usex&quot; /&gt;  
    &lt;!-- 一对多级联查询，ofType表示集合中的元素类型，将uid传递给selectOrdersByld --&gt;  
    &lt;collection property=&quot;ordersList&quot; ofType=&quot;com.po.Orders&quot;  
        column=&quot;uid&quot; select=&quot;com.dao.OrdersDao.selectOrdersByld&quot; /&gt;  
&lt;/resultMap&gt;  
</pre></div>
</div>
<p>动态sql</p>
</div>
<div class="section" id="id11">
<h2>动态sql<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id12">
<h3>动态sql<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--使用 if 元素根据条件动态查询用户信息--&gt;  
&lt;select id=&quot;selectUserByIf&quot; resultType=&quot;com.po.MyUser&quot; parameterType=&quot;com.po.MyUser&quot;&gt;  
    select * from user where 1=1  
    &lt;if test=&quot;uname!=null and uname!=&#39;&#39;&quot;&gt;  
        and uname like concat(&#39;%&#39;,#{uname},&#39;%&#39;)  
    &lt;/if &gt;  
    &lt;if test=&quot;usex !=null and usex !=&#39;&#39;&quot;&gt;  
        and usex=#{usex}  
    &lt;/if &gt;  
&lt;/select&gt;  
</pre></div>
</div>
</div>
<div class="section" id="choosewhenotherwise">
<h3>choose、when、otherwise标签<a class="headerlink" href="#choosewhenotherwise" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--使用choose、when、otherwise元素根据条件动态查询用户信息--&gt;  
&lt;select id=&quot;selectUserByChoose&quot; resultType=&quot;com.po.MyUser&quot; parameterType= &quot;com.po.MyUser&quot;&gt;  
    select * from user where 1=1  
    &lt;choose&gt;  
        &lt;when test=&quot;uname!=null and uname!=&#39;&#39;&quot;&gt;  
            and uname like concat(&#39;%&#39;,#{uname},&#39;%&#39;)  
        &lt;/when&gt;  
        &lt;when test=&quot;usex!=null and usex!=&#39;&#39;&quot;&gt;  
            and usex=#{usex}  
        &lt;/when&gt;  
        &lt;otherwise&gt;  
            and uid &gt; 10  
        &lt;/otherwise&gt;  
    &lt;/choose&gt;  
&lt;/select&gt;  
</pre></div>
</div>
</div>
<div class="section" id="trim">
<h3>trim<a class="headerlink" href="#trim" title="Permalink to this headline">¶</a></h3>
<!--使用trim元素根据条件动态查询用户信息--><p>&lt;select id=”selectUserByTrim” resultType=”com.po.MyUser”parameterType=”com.po.MyUser”&gt;</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">user</span>

<span class="o">&lt;</span><span class="n">trim</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;where&quot;</span> <span class="n">prefixOverrides</span> <span class="o">=</span> <span class="s2">&quot;and | or&quot;</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s2">&quot;uname!=null and uname!=&#39;&#39;&quot;</span><span class="o">&gt;</span>

        <span class="ow">and</span> <span class="n">uname</span> <span class="n">like</span> <span class="n">concat</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="c1">#{uname},&#39;%&#39;)</span>

    <span class="o">&lt;/</span><span class="k">if</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="k">if</span> <span class="n">test</span><span class="o">=</span><span class="s2">&quot;usex!=null and usex!=&#39;&#39;&quot;</span><span class="o">&gt;</span>

        <span class="ow">and</span> <span class="n">usex</span><span class="o">=</span><span class="c1">#{usex}</span>

    <span class="o">&lt;/</span><span class="k">if</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">trim</span><span class="o">&gt;</span>
</pre></div>
</div>
</select><p>例子中：</p>
<p>1、prefix：代表拼接一个where前缀</p>
<p>2、suffixOverrides: 代表去除多余的逗号 “，”</p>
<p>3、prefixOverrides:去除sql语句前面的关键字”and”</p>
</div>
<div class="section" id="where">
<h3>where<a class="headerlink" href="#where" title="Permalink to this headline">¶</a></h3>
<p><where> 元素的作用是会在写入 <where> 元素的地方输出一个 where 语句，另外一个好处是不需要考虑 <where> 元素里面的条件输出是什么样子的，MyBatis 将智能处理。如果所有的条件都不满足，那么 MyBatis 就会查出所有的记录，如果输出后是以 and 开头的，MyBatis 会把第一个 and 忽略。</p>
<p>当然如果是以 or 开头的，MyBatis 也会把它忽略；此外，在 <where> 元素中不需要考虑空格的问题，MyBatis 将智能加上。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--使用where元素根据条件动态查询用户信息--&gt;  
&lt;select id=&quot;selectUserByWhere&quot; resultType=&quot;com.po.MyUser&quot; parameterType=&quot;com.po.MyUser&quot;&gt;  
    select * from user  
    &lt;where&gt;  
        &lt;if test=&quot;uname != null and uname ! = &#39;&#39;&quot;&gt;  
            and uname like concat(&#39;%&#39;,#{uname},&#39;%&#39;)  
        &lt;/if&gt;  
        &lt;if test=&quot;usex != null and usex != &#39;&#39; &quot;&gt;  
            and usex=#{usex}  
        &lt;/if &gt;  
    &lt;/where&gt;  
&lt;/select&gt;  
</pre></div>
</div>
</div>
<div class="section" id="set">
<h3>set<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<p>用 <set> 元素动态更新列</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--使用set元素动态修改一个用户--&gt;  
&lt;update id=&quot;updateUserBySet&quot; parameterType=&quot;com.po.MyUser&quot;&gt;       
    update user  
    &lt;set&gt;  
        &lt;if test=&quot;uname!=null&quot;&gt;uname=#{uname}&lt;/if&gt;  
        &lt;if test=&quot;usex!=null&quot;&gt;usex=#{usex}&lt;/if&gt;  
    &lt;/set&gt;  
    where uid=#{uid}  
&lt;/update&gt;  
</pre></div>
</div>
</div>
<div class="section" id="foreach">
<h3>foreach<a class="headerlink" href="#foreach" title="Permalink to this headline">¶</a></h3>
<p><foreach> 元素主要用在构建 in 条件中，它可以在 SQL 语句中迭代一个集合。</p>
<p><foreach> 元素的属性主要有 item、index、collection、open、separator、close。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>item 表示集合中每一个元素进行迭代时的别名。  
index 指定一个名字，用于表示在迭代过程中每次迭代到的位置。  
open 表示该语句以什么开始。  
separator 表示在每次进行迭代之间以什么符号作为分隔符。  
close 表示以什么结束。  
</pre></div>
</div>
<p>在使用 <foreach> 元素时，最关键、最容易出错的是 collection 属性，该属性是必选的，但在不同情况下该属性的值是不一样的，主要有以下 3 种情况：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>如果传入的是单参数且参数类型是一个 List，collection 属性值为 list。  
如果传入的是单参数且参数类型是一个 array 数组，collection 的属性值为 array。  
如果传入的参数是多个，需要把它们封装成一个 Map，当然单参数也可以封装成 Map。Map 的 key 是参数名，collection 属性值是传入的 List 或 array 对象在自己封装的 Map 中的 key。  
</pre></div>
</div>
<p>样例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!--使用foreach元素查询用户信息--&gt;  
&lt;select id=&quot;selectUserByForeach&quot; resultType=&quot;com.po.MyUser&quot; parameterType=  
&quot;List&quot;&gt;  
    select * from user where uid in  
    &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;  
    open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;  
        # {item}  
    &lt;/foreach&gt;  
&lt;/select&gt;  
</pre></div>
</div>
</div>
<div class="section" id="bind">
<h3>bind标签<a class="headerlink" href="#bind" title="Permalink to this headline">¶</a></h3>
<p>平时写模糊查询，一直用${name}，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">table</span> <span class="n">where</span> <span class="n">name</span> <span class="n">like</span> <span class="s1">&#39;%$</span><span class="si">{name}</span><span class="s1">%&#39;</span>  
</pre></div>
</div>
<p>后来知道了，这样写可能会引发sql注入，于是乎，要用到这样一个标签 bind，经过改正上面的sql可以变成</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">bind</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bindeName&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&#39;%&#39;+name+&#39;%&#39;&quot;</span><span class="o">/&gt;</span>  
<span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">table</span> <span class="n">where</span> <span class="n">name</span> <span class="n">like</span> <span class="c1">#{bindeName}  </span>
</pre></div>
</div>
<p>大致就上面这个意思，不要在意一些细节。就相当于在bind标签中的value值中，把需要的字符拼接好，然后用name中的值去代替拼接好的参数。</p>
<p>这个用法同样用于一些防止更换数据库的sql中。例如：
concat标签，在mysql中，可以拼接多个字符，但是如果有一天，你的数据库突然变成了oracle，concat就会报错了，因为它只能接受两个参数。</p>
<p>这个时候，bind同样适用，如下：</p>
<p>开始的时候：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;if test=” userName != null and userName ! = ””&gt;  
　　and username like concat （ &#39;1&#39;,＃｛userName｝,&#39;2&#39; ）  
&lt;/if&gt;  
</pre></div>
</div>
<p>可以改成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;if test=” userName != null and userName !=””&gt;   
　　&lt;bind name= &quot; userNameLike ” value ＝ ”&#39;1&#39;＋ userName ＋ &#39;2&#39;”/&gt;  
　　and username like #{userNameLike}   
&lt;/if&gt;　　  
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h2>参考<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p>MyBatis ：http://c.biancheng.net/view/4314.html</p>
<p>DefaultSqlSessionFactory和SqlSessionManager的区别：https://blog.csdn.net/qq_39396243/article/details/104018189</p>
<p>mybatis bind标签:https://www.cnblogs.com/bpjj/p/11880424.html</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="java_微服务01学习笔记.html" class="btn btn-neutral float-right" title="java_微服务01学习笔记" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="java_spring05循环依赖.html" class="btn btn-neutral float-left" title="java_spring05循环依赖" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, yuanjh

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>